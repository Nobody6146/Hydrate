<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"/>
        <title>Hydrate Demo</title>
        <script src="hydrate.js"></script>
        <style>
            .red {
                color: red;
            }
        </style>
    </head>
    <body>

        <div>
            <header>
            
            </header>
    
            <!-- <main>
                <input h-model="default" h-property="text value" h-input="text value" value="Testing">
                <div h-model="default" h-property="text innerHTML" h-attribute="text name">
                    Sample text
                </div>
                <div h-model="default.object" h-property="text innerHTML" h-attribute="text name">
                    Sample text 2
                </div>
            </main> -->
    
            <template h-template="ExampleTemplate">
                <h1>Example Component</h1>
                <p h-model="^.name" h-property="textContent: `${first} ${last}`"></p>
            </template>
            <template h-template="ListTemplate">
                <li h-model="^" h-property="textContent: `key: ${$detail.modelName}, value: ${$detail.state}`"></li>
            </template>
            <template h-template="SelectorTemplate">
                <option h-model="^" h-property="textContent: name; value: value;">Option</option>
            </template>

            <template h-template="HomePageTemplate">
                <h1>Home</h1>
            </template>
            <template h-template="ContactPageTemplate">
                <div h-model h-component="template: 'LoadingPageTemplate'" h-routing="start">
                    Loading...
                </div>
                <div h-model h-component="template: 'ContactPageContentTemplate'" h-routing="resolve"></div>
                <div h-model h-component="template: 'RejectedPageTemplate'" h-routing="reject"></div>
            </template>
            <template h-template="ContactPageContentTemplate">
                <h1>Contact</h1>
            </template>
            <template h-template="PageNotFoundTemplate">
                <h1>Page not found!</h1>
            </template>
            <template h-template="LoadingPageTemplate">
                Loading...
            </template>
            <template h-template="RejectedPageTemplate">
                Error loading page
            </template>


            <template h-template="StarTemplate">
                <div h-model="^" h-property="innerText: $id() <= $state ? '&#9733' : '&#9734'" h-id
                    h-on="click: $detail.parent[$detail.modelName] = $id()">
                Star</div>
            </template>


            <main>

                <div>
                    <h1>
                        Welcome
                    </h1>
                    
                    <div>
                        <div h-route="#home">
                            <div h-model h-component="template: 'LoadingTemplate'" h-routing="start" h-event="routing.start: document.title = 'Demo | Home'"></div>
                            <div h-model h-component="template: 'HomePageTemplate'" h-routing="resolve"></div>
                        </div>
                        <div h-model h-component="url: 'demopages/about.html'" h-route="#about" h-routing="resolve" h-event="routing.resolve: document.title = 'Demo | About'"></div>
                        <div h-model h-component="template: 'ContactPageTemplate'" h-route="#contact" h-routing="start" h-event="routing.start: document.title = 'Demo | Contact'">
                            Check
                        </div>
                        <div h-model h-component="template: 'PageNotFoundTemplate'" h-route="#404" h-routing="resolve" h-event="routing.resolve: document.title = 'Demo | 404'"></div>
                    </div>
                </div>

                <a href="#home">Home</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
                <a href="#badUrl">Bad Link</a>
                <a href="?sort=Top#test/3">Test Link</a>

                <div h-model="default" h-remove>
                    We are a deleteable div!
                </div>
                <div h-model h-property="textContent: 'Overrided text from modeless component!'">Same Text</div>
                <input h-model="default" h-property="value: text" h-input="text: $element.value" value="Testing" h-event="track: console.log('got data!', $detail)" h-throttle="input: 750">
                <input h-model="default" h-property="value: text" h-on="input: $model.text = $element.value" h-debounce="on: 750">
                <input h-model="default" h-property="value: text" h-on="input: $model.text = $element.value" h-delay="on: 1000">
                <button h-model="default" h-on="click: alert(`Hello! Text: ${text}`);click: console.log('clicked me!')">Alert</button>
                <div h-model="default" h-property="'innerHTML': text" h-attribute="name: text">
                    Sample text
                </div>
                <div h-model h-component="template: 'ExampleTemplate'">
                    Placeholder text that will be deleted
                </div>
                <ul h-model="default.list" h-component="template: 'ListTemplate'">
                    Placeholder list will be deleted
                </ul>
                <p h-model="default.person.name" h-property="textContent: `${first} ${last}`">lnkjhk</p>
                <p h-model="default.person.name" h-property="textContent: first"></p>

                <select h-model="default.selector" h-property="value: value" h-mutation="child: added">
                    <option selected value="" disabled>Select Value</option>
                    <optgroup h-model="default.selector.options" h-component="template: 'SelectorTemplate'">
                        <option>Test 1</option>
                        <option>Test 2</option>
                    </optgroup>
                </select>

                <input h-model="default.toggle" h-class="red: shouldRed" h-toggle="disabled: shouldDisable" value="Test" >
                
                <div h-model="default.rank" h-component="template: 'StarTemplate'" h-duplicate="5"
                    style="display: flex;">
                </div>
            </main>
    
            <footer>
                <p>The literal and graphical information presented on this site about Digimon, including card images and card text, is copyright Bandai Namco Entertainment and Toei Animation. This website is not produced by, endorsed by, supported by, or affiliated with Bandai Namco Entertainment and Toei Animation.
                    All other content Â© 2020-2022 DigimonCard.
                </p>
            </footer>
            <script>
                // document.body.addEventListener("hydrate.track", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.untrack", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.bind", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.set", event => console.log(event.type, event.detail));
                //document.body.addEventListener("hydrate.unbind", event => console.log(event.type, event.detail));

                // document.body.addEventListener("hydrate.mutation.parent.attribute", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.parent.added", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.parent.removed", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.parent.characters", event => console.log(event.type, event.detail));
                // //
                //document.body.addEventListener("hydrate.mutation.target.attribute", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.target.added", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.target.removed", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.target.characters", event => console.log(event.type, event.detail));
                // //
                // document.body.addEventListener("hydrate.mutation.child.attribute", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.child.added", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.child.removed", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.mutation.child.characters", event => console.log(event.type, event.detail));
                // //
                // document.body.addEventListener("hydrate.route", event => console.log(event.type, event.detail));
                //
                document.body.addEventListener("hydrate.input", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.on", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.routing.start", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.routing.resolve", event => console.log(event.type, event.detail));
                // document.body.addEventListener("hydrate.routing.reject", event => console.log(event.type, event.detail));
                

                let options = {
                    debug: {
                        dispatchTimer: true
                    }
                };
                let app = new HydrateApp(options);
                let div = document.querySelector("div");
                //let model = app.bind("default", {text: "hello", list: [{first: "Brandon", last: "Biera"}, {first:"Megan",last:"Wong"}]});
                let model = app.bind("default", {text: "hello", list: [1,2,3,4], person: {name: {first: "Brandon", last: "Biera"}}});
                model.selector = {
                    options: [
                        {name: "Car", value: 1},
                        {name: "Boat", value: 2},
                        {name: "Plane", value: 3},
                    ],
                    value: 3
                }
                model.toggle = {
                    shouldRed: false,
                    shouldDisable: false
                }
                model.rank = 3;

                //Define our client side routes
                let routeMap = new Map();
                routeMap.set("#", (resolvedRoute, request) => {
                    console.log("routing");
                });
                routeMap.set("#", (resolvedRoute, request) => {
                    request.response = () => app.route("#home");
                });
                routeMap.set("#home", (resolvedRoute, request) => {
                    //console.log(resolvedRoute);
                    request.response = () => request.resolve();
                });
                routeMap.set("#about", (resolvedRoute, request) => {
                    request.response = () => request.resolve();
                });
                routeMap.set("#contact", (resolvedRoute, request) => {
                    //console.log(resolvedRoute);
                    throw Error("Testing breaking route");
                });
                routeMap.set("#404", (resolvedRoute, request) => {
                    //console.log(resolvedRoute);
                    request.response = () => request.resolve();
                });
                routeMap.set("#test/:id", (resolvedRoute, request) => {
                    request.response = () => request.resolve();
                });
                routeMap.set("", (resolvedRoute, request) => {
                    //console.log("page not found: ", + resolvedRoute);
                    request.response = () => app.route(`?page=3#404`);
                });

                //Create our routing middleware
                document.body.addEventListener("hydrate.routing.start", event => {
                    try{
                        let request = event.detail.request;
                        let routes = request.match(request.url, ...routeMap.keys());
                        for(let route of routes)
                        {
                            routeMap.get(route.route)(route, request);
                            if(request.response)
                            {
                                event.preventDefault();
                                request.response();
                                break;
                            }
                        }
                    }
                    catch(err) {
                        console.error(err);
                        event.detail.request.reject();
                    }
                });

                //Route to current page
                app.route();

                // let event = new HydrateModelEvent();
                // event.target = div;
                // event.hydrate = app;
                // event.type = "bind";
                // event.propPath = "default.text";
                // event.prop = "hello world";
                // app.dispatch(event);
            </script>
        </div>
        
    </body>
</html>