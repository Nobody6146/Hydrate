<template h-model="header" h-init>
    <header>
        <h1 h-model="^" h-property="textContent: title"> </h1>
        <app-button
            h-model="^.button"
            h-route="#home" h-routing="resolve"
        >
        </app-button>
    </header>
    <script h-script>
        class Component {
            #showAddSubscription;

            onInit(detail) {
                this.$model.title = "Task Tracker";
                this.$model.showAdd = false;
                this.$model.button = {
                    text: "",
                    color: "",
                    onClick: this.#toggleShowAdd.bind(this)
                };
                
                this.#showAddSubscription = APP.uiService.subscribeToShowAddTaskMenu( function({state}) {
                    this.$model.showAdd = state;
                    this.#updateButton(state);
                }.bind(this));
                //Will tell the subscription to automatically fire the callback with the current data
                this.#showAddSubscription.trigger();
            }
            onDestroy() {
                this.#showAddSubscription.unsubscribe();
            }
            #updateButton(showAddTaskMenu) {
                this.$model.button.text = showAddTaskMenu ? "Close" : "Add";
                this.$model.button.color = showAddTaskMenu ? "red" : "green";
            }
            #toggleShowAdd() {
                APP.uiService.toggleAddTaskMenu();
            }
        }
    </script>
</template>