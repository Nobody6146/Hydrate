<template h-model="tasks" h-init h-route="#home" h-routing="resolve">
    <p h-model="^.list.length" h-property="textContent: `Total: ${$state}`"></p>
    <app-add-task h-model="^.addTaskForm"></app-add-task>
    <app-task-item h-model="^.list"></app-task-item>
    <script h-script>
        class Component {
            #tasksSubscription;

            onInit() {
                this.#tasksSubscription = APP.taskService.subscribeToTasks(function({state}) {
                    this.$model.list = state;
                }.bind(this));
                //Will tell the subscription to automatically fire the callback with the current data
                this.#tasksSubscription.trigger();
                
                this.$model.addTaskForm = {
                    task: APP.taskService.emptyTask(),
                    showAddTask: true,
                    addTask: this.addTask.bind(this)
                }
            }
            onDestroy() {
                this.#tasksSubscription.unsubscribe();
            }
            addTask(task) {
                APP.taskService.addTask(task);
                this.$model.addTaskForm.task = APP.taskService.emptyTask();
            }
            toggleReminder(task) {
                APP.taskService.toggleReminder(task.id);
            }
            deleteTask(task) {
                APP.taskService.deleteTask(task.id);
            }
        }
    </script>
</template>