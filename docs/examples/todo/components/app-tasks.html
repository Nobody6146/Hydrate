<template h-model="tasks" h-init h-route="#home" h-routing="resolve">
    <p h-model="^.list.length" h-property="textContent: `Total: ${$state}`"></p>
    <app-add-task h-model="^.addTaskForm"></app-add-task>
    <app-task-item h-model="^.list"></app-task-item>
    <script h-script>
        class Component {
            onInit() {
                this.$model.list = TaskService.loadTasks();
                const component = this;
                this.$model.addTaskForm = {
                    task: TaskService.createTask(),
                    showAddTask: true,
                    addTask: component.addTask.bind(this)
                }
            }
            addTask(task) {
                const tasks = this.$state.list;
                task.id = tasks.reduce((x, y) => y > x ? y : x, 1);
                this.$model.list.push(task);
                this.$model.addTaskForm.task = TaskService.createTask();
                TaskService.saveTasks(tasks);
            }
            toggleReminder(task) {
                const tasks = this.$state.list;
                let index = tasks.indexOf(task);
                if(index < 0)
                    return;
                this.$model.list[index].reminder = !task.reminder;
                TaskService.saveTasks(tasks);
            }
            deleteTask(task) {
                const tasks = this.$state.list;
                let index = tasks.indexOf(task);
                if(index < 0)
                    return;
                this.$model.list.splice(index, 1);
                TaskService.saveTasks(tasks);
            }
        }
    </script>
</template>